INTRODUCTION
------------
T24WTHR.DLL is a Win32 function library for California residential simulation software.  Embedded in T24WTHR.DLL
are 16 TMY2 weather files corresponding to the 16 California climate zones.  In addition to the TMY2 data, T24WTHR.DLL
calculates dew point, TGround, TSky and 7-day average lag temperature.

USING T24WTHR.DLL
-----------------
T24WTHR.DLL has four public functions, callable from any programming languate that supports Win32 function libraries.
The functions assume C calling conventions, and strings are in ASCIIZ format.

For typical use of t24WTHR.DLL functions, the calling program will call T24InitWthr once for each simulation run to
initialize the weather tables, then call T24HrWthr once per hour for each desired data field.  Calling details are 
shown below.  If the calling program is running multiple iterations in the same climate zone, T24InitWthr need only be 
called once before the first iteration.  A research version of T24InitWthr, called T24InitWthrResearch, allows the calling
program to use any TMY2-format or TMY3-format weather file.  This function is used in place of T24InitWthr.

The T24WthrLocation function added with Version 2013.W0.01 is primarily intended for external libraries' access to weather
station location data.  Ordinarily an ACM program will not need to call this function.

Dependant libraries:
	T24ASM32.DLL
	T24UNZIP.DLL

REVISION HISTORY
----------------

Version 2013.W0.11: 01 November 2012
Bug fix in T24InitWthrResearch returned value, fixes in function documentation.

Version 2013.W0.10: 14 August 2012
Bug fix in T24InitWthrResearch.  No other changes.

Version 2013.W0.09: 08 March 2012
Bug fix in TGround calculations.  No other changes.

Version 2013.W0.08: 08 February 2012
Bug fix: research verion with T24WthrLocation function enabled.  No other changes.

Version 2013.W0.07: 01 February 2012
Error messaging revised.  All functions now return an error message code in register EAX in addition to
copying an ASCIIZ error message to the caller's message buffer.  An error message code of 0 indicates no
error.  This conforms with error messaging in other T24 DLL functions.

Version 2013.W0.06: 12 January 2012
Added support for Lag14 and Lag31 data fields.  No other changes.

Version 2013.W0.05: 16 June 2011
Revised calls to T24TDV.DLL in research version.  No other changes.

Version 2013.W0.04: 16 March 2011
Speed improvement in T24InitWthr.  No other changes.

Version 2013.W0.03: 04 March 2011
Fixed bug in T24WthrLocation function used by T24SOLAR.DLL.  Does not affect any other T24WTHR.DLL functions.

Version 2013.W0.02: 15 February 2011
Added support for weather files in TMY3 format.  The function automaticaly detects the file format, correctly parsing
either TMY2 or TMY3 files.

Version 2013.W0.01: 08 February 2011
Added T24InitWthrResearch function, which is used to read external weather files in place of the embedded weather files
ordinarily used for compliance.  Added T24WthrLocation function, which is used to copy weather station location data to
the calling program.  This function is used by T24SOLAR.DLL functions to calculate solar geometry.  All functions return
TRUE (1) if successful, FALSE (0) if failed.  This version of T24WTHR.DLL is not presently certified for compliance with
California Title 24 code.

Version 2013.W0: 04 February 2011
First trial/demo version, with weather files for 16 California climate zones proposed for 2013 Standards.
This version is not presently certified for compliance with California Title 24 code.



-----------
T24InitWthr
-----------
Initializes weather tables.
This function or the research version T24InitWthrResearch must be called before calling other T24WTHR.DLL functions.
The function fails returning an error code and an error message if the Climate Zone parameter is out-of-bounds.
The function returns 0 to indicate successful initialization.  Error messages are copied to the caller's error message 
buffer and the buffer is cleared if there was no error.

PowerBASIC prototype:
DECLARE FUNCTION T24InitWthr CDECL LIB "T24WTHR.DLL" ALIAS "T24InitWthr" _
       (BYVAL CZ AS LONG, _               ' California Climate Zone 1-16
        BYVAL VerMsg AS DWORD, _          ' pointer to buffer for weather version info.
                                          ' T24InitWthr will copy an ASCIIZ version information string to this buffer.
                                          ' The version information buffer should reserve at least 80 bytes.
        BYVAL pErr AS DWORD _             ' pointer to buffer for error message.  If the function is successful the 
                                          ' error message is NUL and the function returns 0.
                                          ' The calling program should reserve at least 80 bytes for error messages.
       ) AS LONG


Error messages:
                 'Invalid Climate Zone.  Climate zone must be between 1 and 16.'

How it works:
A .ZIP file containing 16 TMY2 weather files corresponding to the 16 California climate zones is embedded in the program.  Initialization
uses T24UNZIP.DLL to extract the selected weather file to program memory, where it is then parsed and numerous calculations are performed.



-------------------
T24InitWthrResearch
-------------------
Initializes weather tables from an external file.
This function or the compliance version T24InitWthr must be called before calling other T24WTHR.DLL functions.
The function fails if the external file cannot be opened.  The function returns 0 and a nul error message if
successful.

PowerBASIC prototype:
DECLARE FUNCTION T24InitWthrResearch CDECL LIB "T24WTHR.DLL" ALIAS "T24InitWthr" _
       (BYVAL FILENAME AS DWORD, _         ' pointer to an external weather file in TMY2 or TMY3 format
        BYVAL pVer AS DWORD, _             ' pointer to caller's version info buffer
        BYVAL pErr AS DWORD _              ' pointer to caller's error message buffer
       ) AS LONG

FILENAME:  The ASCIIZ name of an external file in TMY2 or TMY3 format.  Long file names are not supported.

pVer:      pointer to buffer for weather version info.
           T24InitWthr will copy an ASCIIZ version information string to this buffer.  The version information 
           buffer should reserve at least 80 bytes.

pErr:      pointer to buffer for error message.  If the function is successful, the error message is NUL.
           In the event of an error this function copies an error message to the caller's buffer.
           The calling program should reserve at least 80 bytes for error messages.

Error messages:
                 'Cannot read weather file.'
                 'File corrupt or field missing.'

This function is used in place of T24InitWthr and is not to be used for compliance with California Title 24 code.



---------
T24HrWthr
---------
Returns (float) weather data for a given hour.
T24InitWthr must have been previously called to initialize the weather data.

PowerBASIC prototype:
DECLARE FUNCTION T24HrWthr CDECL LIB "T24WTHR.DLL" ALIAS "T24HrWthr" _
       (BYVAL MONTH AS LONG, _                      ' 1 to 12
        BYVAL DAY AS LONG, _                        ' 1 to last day of month, (28, 30 0r 31)
        BYVAL HOUR AS LONG, _                       ' 1 to 24
        BYVAL DATAFIELD AS LONG, _                  ' described below
        BYVAL pErr AS DWORD _                       ' pointer to caller's error message buffer
       ) AS SINGLE

DATAFIELD is an index to a data field in the library's weather data
        WthrDB = 1                                  ' dry bulb, F
        WthrWB = 2                                  ' wet bulb, F
        WthrDP = 3                                  ' dew point, F
        WthrTG = 4                                  ' Ground Temperature, F
        WthrTS = 5                                  ' Tsky, F
        WthrBR = 6                                  ' direct normal radiation, Btu/sf
        WthrDR = 7                                  ' diffuse radiation, Btu/sf
        WthrWS = 8                                  ' wind speed, miles/hr
        WthrPA = 9                                  ' atmospheric pressure, mb
        WthrTL7 = 10                                ' 7-day average temperature with lag, degrees F
        WthrTL14 = 11                               ' 14-day average temperature with lag, degrees F
        WthrTL31 = 12                               ' 31-day average temperature with lag, degrees F

These data field indexes are defined in the include files t24wthr.inc for assembly language and 
t24wthr.pbi for PowerBASIC.

NOTE: wind speed returned by this function is not adjusted for Title 24 shielding factor.
Before calculating building infiltration the ACM program must multiply the value returned
for wind speed by 0.25 per 2008 Residential ACM Section Section 3.3.3, Ventilation and Infiltration.

pErr:   pointer to buffer space for error message
        If ErrMsg = -1, no error message is returned.
        In the event of an error, this function returns a value of 99999 and unless
        ErrMsg = -1 an ASCIIZ error mesasge is copied to the caller's buffer.
        The buffer for error messages should be at least 64 bytes.

Error messages:
        'Bad data field index in T24HrWthr'
        'Bad day index in T24HrWthr'
        'Bad month index in T24HrWthr.  Month must be between 1 and 12'
        'Bad hour index in T24HrWthr.  Hour must be between 1 and 24'
        'T24WTHR.DLL has not been initialized.  Call T24InitWthr before using T24HrWthr.'

Returns (float) FIELD data for MONTH, DAY, HOUR



---------------
T24WthrLocation
---------------
Returns weather station location data to the calling program.
T24InitWthr must have been previously called to initialize the weather data.

PowerBASIC prototype:
DECLARE FUNCTION T24WthrLocation CDECL LIB "T24WTHR.DLL" ALIAS "T24WthrLocation" (LocData AS DWORD, VerMsg AS ASCIIZ, ErrMsg AS ASCIIZ) AS LONG

LocData: Pointer to WTHRLOC data structure.  The WTHRLOC fields will be filled in by this function.

VerMsg:  T24WthrLocation will copy an ASCIIZ version information string to this buffer.
         The calling program should copy the expected root version string '2013.W0' to this buffer
         before calling T24WthrLocation.  T24WthrLocation will check the version and return the full version string
         to the calling program, overwriting the root version string.  The version information buffer should reserve
         at least 80 bytes.

ErrMsg:  pointer to buffer for error message.  If the function is successful, the error message is NUL and the
         function returns TRUE (1).  If ErrMsg = -1 no error message will be returned to the calling program.
         In the event of an error this function returns FALSE (0) and unless ErrMsg = -1 an error message is
         copied to the caller's buffer.  The calling program should reserve at least 90 bytes for error messages.
         NOTE THAT THIS BUFFER SPACE REQURIEMENT IS GREATER THAN FOR OTHER T24WTHR.DLL FUNCTIONS.

Error messages are:
         'Incorrect T24WTHR.DLL version.',0
         'T24WTHR.DLL has not been initialized.  Call T24InitWthr before using T24WthrLocation.'

sample FASM WTHRLOC data structure:

struct	WTHRLOC

cz	dd ?		; California climate zone (LONG in PowerBASIC, int in 32-bit C#)
tzn	dd ?		; time zone, -8 for all California (LONG in PowerBASIC, int in 32-bit C#)
lat	dd ?		; latitude (SINGLE in PowerBASIC, float in 32-bit C#)
lon	dd ?		; longitude (SINGLE in PowerBASIC, float in 32-bit C#)
elev	dd ?		; elevation (SINGLE in PowerBASIC, float in 32-bit C#) (not presently used)

ends
